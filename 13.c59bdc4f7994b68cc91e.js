(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{h3Zs:function(e,t,o){"use strict";o.r(t),o.d(t,"UsersModule",(function(){return Z}));var r=o("sEIs"),c=o("C05f"),i=o("ZTXN"),n=o("ROBh"),s=o("47ST"),a=o("Ecwh"),l=o("SKbq"),b=o("kuMc"),u=o("cJ9h"),m=o("YtkY"),d=o("4e/d"),h=o("J+dc"),g=o("jxfh"),p=o("gLp2"),f=o("nIj0"),O=o("OZ4H"),U=o("EM62"),C=o("qFEQ"),k=o("PBFl"),v=o("bFHC"),P=o("Meci"),S=o("29Wa"),I=o("Cd2c"),D=o("zmEM"),L=o("2kYt");function y(e,t){if(1&e){const e=U.Vb();U.Ub(0,"div",20),U.Ub(1,"div",21),U.Ub(2,"mat-icon"),U.Pc(3,"person_outline"),U.Tb(),U.Ub(4,"p",22),U.Pc(5),U.Tb(),U.Tb(),U.Ub(6,"span",21),U.Ub(7,"button",23),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc(2).openLocationDialog(o)})),U.Pc(8),U.Tb(),U.Ub(9,"span",24),U.Ub(10,"button",25),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc(2).removeRole(o.role)})),U.Ub(11,"mat-icon"),U.Pc(12,"cancel"),U.Tb(),U.Tb(),U.Tb(),U.Tb(),U.Tb()}if(2&e){const e=t.$implicit,o=U.kc(2);U.Bb(5),U.Qc(e.role.Name),U.Bb(3),U.Qc(o.getLocationString(e.locations))}}function w(e,t){if(1&e&&(U.Ub(0,"div",18),U.Nc(1,y,13,2,"div",19),U.Tb()),2&e){const e=t.ngIf;U.Bb(1),U.sc("ngForOf",e)}}let M=(()=>{class e{constructor(e,t,o,r,i,n,s,a){this.apiRoleService=e,this.uiListSelectService=t,this.data=o,this.dialogRef=r,this.formBuilder=i,this.apiLocationService=n,this.apiUserService=s,this.notificationService=a,this.roleLocationObjects=new c.a(null),this.formValid=new c.a(!1),this.createForm()}createNewUser(){const e={FirstName:this.newUserForm.value.firstName,LastName:this.newUserForm.value.lastName,Email:this.newUserForm.value.email,OrgID:this.data.CurrentOrg.ID,Permission:a.Permissions.Viewer,JobTitle:"User",CreatedBy:this.data.CurrentUser.ID,RoleLocations:this.formatForUpdateOrgUser()};this.apiUserService.createOrgUser(e).pipe(Object(h.a)(1)).subscribe(t=>{"success"===t.Status?(this.dialogRef.close(),this.notificationService.show(g.NotificationType.success,"Close",`${e.FirstName} ${e.LastName} created`,5e3)):"error"===t.Status&&this.notificationService.show(g.NotificationType.error,"Close",""+t.Message,5e3)})}close(){this.dialogRef.close()}openRoleDialog(){this.apiRoleService.getRolesByOrg(this.data.CurrentOrg.ID).subscribe(e=>{this.uiListSelectService.open({inputList:e.OrgRoleList,currentSelectedList:this.selectedRoles,primaryValueSelector1:"Name",compareValueBy:"ID",iconClass:"person_outline"}),this.uiListSelectService.closed().subscribe(e=>{if(e.length<=0)return this.roleLocationObjects.next([]),void(this.selectedRoles=[]);let t=e,o=[];this.roleLocationObjects.value&&this.roleLocationObjects.value.length>0&&(t=e.filter(e=>!this.roleLocationObjects.value.some(t=>t.role.ID===e.ID)),o=this.roleLocationObjects.value.filter(t=>e.some(e=>t.role.ID===e.ID)),e.forEach(e=>{this.roleLocationObjects.next(this.roleLocationObjects.value.filter(t=>t.role.ID===e.ID))})),this.selectedRoles=e,t.length>0&&this.apiLocationService.getLocationsByOrgId(this.data.CurrentOrg.ID).subscribe(e=>{this.uiListSelectService.open({inputList:e,primaryValueSelector1:"Name",compareValueBy:"ID",iconClass:"domain"}),this.uiListSelectService.closed().subscribe(e=>{if(!e)return;const r=[{role:t[0],locations:e}];t.forEach(t=>{r.some(e=>e.role.ID!==t.ID)&&r.push({role:t,locations:e})}),this.roleLocationObjects.next(o?o.concat(r):r),this.checkForm()})})})})}openLocationDialog(e){this.apiLocationService.getLocationsByOrgId(this.data.CurrentOrg.ID).subscribe(t=>{this.uiListSelectService.open({inputList:t,currentSelectedList:e.locations,primaryValueSelector1:"Name",compareValueBy:"ID",iconClass:"domain"}),this.uiListSelectService.closed().subscribe(t=>{t&&(this.roleLocationObjects.next(this.roleLocationObjects.value.map(o=>o.role.ID===e.role.ID?{role:e.role,locations:t}:o)),this.checkForm())})})}removeRole(e){this.selectedRoles=this.selectedRoles.filter(t=>t.ID!==e.ID),this.roleLocationObjects.next(this.roleLocationObjects.value.filter(t=>t.role.ID!==e.ID)),this.checkForm()}checkForm(){let e=!0;this.newUserForm.valid&&this.roleLocationObjects.value?this.roleLocationObjects.value.forEach(t=>{t.locations||(e=!1)}):e=!1,this.formValid.next(e)}getLocationString(e){return e?e.length<=1?e[0].Name:e.length+" Locations":"Add Location"}createForm(){this.newUserForm=this.formBuilder.group({firstName:["",f.H.required],lastName:["",f.H.required],email:["",[f.H.required,f.H.email]]})}formatForUpdateOrgUser(){let e=null;return this.roleLocationObjects.value.forEach(t=>{t.locations.forEach(o=>{e?e.push({RoleID:t.role.ID,LocationID:o.ID}):e=[{RoleID:t.role.ID,LocationID:o.ID}]})}),e}}return e.\u0275fac=function(t){return new(t||e)(U.Ob(a.ApiRoleService),U.Ob(g.UiListSelectDialogService),U.Ob(O.a),U.Ob(O.h),U.Ob(f.g),U.Ob(a.ApiLocationService),U.Ob(a.ApiUserService),U.Ob(g.UiNotificationService))},e.\u0275cmp=U.Ib({type:e,selectors:[["xenon-new-user-form"]],decls:35,vars:7,consts:[["fxLayoutAlign","space-between",1,"background-white","nav-divider"],["fxLayoutAlign","start center",1,"ml-3"],["mat-icon-button","",3,"click"],["fontSet","material-icons-outlined"],[1,"m-0"],["mat-stroked-button","","color","primary",1,"p-2","m-3",3,"disabled","click"],[1,"dialog-body"],["fxLayout","column",3,"formGroup"],["fxLayoutAlign","space-between center"],["appearance","outline","fxFlex","50%",1,"mr-2"],["matInput","","formControlName","firstName",3,"blur"],["appearance","outline","fxFlex","50%",1,"ml-2"],["matInput","","formControlName","lastName",3,"blur"],["appearance","outline","fxFlex","100%"],["matInput","","formControlName","email",3,"blur"],["class","mt-2",4,"ngIf"],["mat-button","",1,"text-left","color-primary","mt-3","p-0",3,"click"],[1,"mr-3"],[1,"mt-2"],["class","list-row","fxLayoutAlign","space-between center",4,"ngFor","ngForOf"],["fxLayoutAlign","space-between center",1,"list-row"],["fxLayoutAlign","start center"],[1,"mb-0","text-body1","ml-3"],["mat-button","",3,"click"],[1,"set-size"],["mat-icon-button","",1,"remove-button",3,"click"]],template:function(e,t){1&e&&(U.Ub(0,"div",0),U.Ub(1,"span",1),U.Ub(2,"button",2),U.gc("click",(function(){return t.close()})),U.Ub(3,"mat-icon",3),U.Pc(4,"close"),U.Tb(),U.Tb(),U.Ub(5,"h6",4),U.Pc(6,"Add New User"),U.Tb(),U.Tb(),U.Ub(7,"button",5),U.gc("click",(function(){return t.createNewUser()})),U.lc(8,"async"),U.Pc(9,"ADD"),U.Tb(),U.Tb(),U.Ub(10,"div",6),U.Ub(11,"mat-card"),U.Ub(12,"h6"),U.Pc(13,"User Account"),U.Tb(),U.Ub(14,"form",7),U.Ub(15,"div",8),U.Ub(16,"mat-form-field",9),U.Ub(17,"mat-label"),U.Pc(18,"First Name"),U.Tb(),U.Ub(19,"input",10),U.gc("blur",(function(){return t.checkForm()})),U.Tb(),U.Tb(),U.Ub(20,"mat-form-field",11),U.Ub(21,"mat-label"),U.Pc(22,"Last Name"),U.Tb(),U.Ub(23,"input",12),U.gc("blur",(function(){return t.checkForm()})),U.Tb(),U.Tb(),U.Tb(),U.Ub(24,"mat-form-field",13),U.Ub(25,"mat-label"),U.Pc(26,"Email"),U.Tb(),U.Ub(27,"input",14),U.gc("blur",(function(){return t.checkForm()})),U.Tb(),U.Tb(),U.Tb(),U.Pb(28,"mat-divider"),U.Nc(29,w,2,1,"div",15),U.lc(30,"async"),U.Ub(31,"button",16),U.gc("click",(function(){return t.openRoleDialog()})),U.Ub(32,"mat-icon",17),U.Pc(33,"add_circle_outline"),U.Tb(),U.Pc(34," Add Role "),U.Tb(),U.Tb(),U.Tb()),2&e&&(U.Bb(7),U.sc("disabled",!0!==U.mc(8,3,t.formValid)),U.Bb(7),U.sc("formGroup",t.newUserForm),U.Bb(15),U.sc("ngIf",U.mc(30,5,t.roleLocationObjects)))},directives:[C.e,k.b,v.a,P.a,f.J,f.u,C.f,f.l,S.c,C.b,S.g,I.b,f.d,f.t,f.j,D.a,L.u,L.t],pipes:[L.b],styles:[".color-red[_ngcontent-%COMP%]{color:#e60404!important}.color-red-dark[_ngcontent-%COMP%]{color:#ad1b1b!important}.color-red-light[_ngcontent-%COMP%]{color:#ffcdd2!important}.color-gray[_ngcontent-%COMP%]{color:#586069!important}.color-gray-light[_ngcontent-%COMP%]{color:#f7f8f8!important}.color-white[_ngcontent-%COMP%]{color:#fff!important}.color-black[_ngcontent-%COMP%]{color:#000!important}.color-border-light[_ngcontent-%COMP%]{color:#e0e0e0!important}.color-primary[_ngcontent-%COMP%]{color:#048be6!important}.color-primary-dark[_ngcontent-%COMP%]{color:#005797!important}.color-primary-light[_ngcontent-%COMP%]{color:#def2fe!important}.color-accent[_ngcontent-%COMP%]{color:#037dd1!important}.background-red[_ngcontent-%COMP%]{background-color:#e60404!important}.background-red-dark[_ngcontent-%COMP%]{background-color:#ad1b1b!important}.background-red-light[_ngcontent-%COMP%]{background-color:#ffcdd2!important}.background-gray[_ngcontent-%COMP%]{background-color:#586069!important}.background-gray-light[_ngcontent-%COMP%]{background-color:#f7f8f8!important}.background-white[_ngcontent-%COMP%]{background-color:#fff!important}.background-black[_ngcontent-%COMP%]{background-color:#000!important}.background-border-light[_ngcontent-%COMP%]{background-color:#e0e0e0!important}.background-primary[_ngcontent-%COMP%]{background-color:#048be6!important}.background-primary-dark[_ngcontent-%COMP%]{background-color:#005797!important}.background-primary-light[_ngcontent-%COMP%]{background-color:#def2fe!important}.background-accent[_ngcontent-%COMP%]{background-color:#037dd1!important}.background-gradient[_ngcontent-%COMP%]{background:linear-gradient(180deg,#fff,#def2fe 78.12%,#e6f5fe)!important}[_nghost-%COMP%]   .nav-divider[_ngcontent-%COMP%]{border-bottom:1px solid #e0e0e0}[_nghost-%COMP%]   .dialog-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin-top:30px}[_nghost-%COMP%]   .dialog-body[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{width:732px}[_nghost-%COMP%]   .list-row[_ngcontent-%COMP%]{min-height:40px;border-radius:50px}[_nghost-%COMP%]   .list-row[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .list-row[_ngcontent-%COMP%]:hover{background-color:#f7f8f8}[_nghost-%COMP%]   .list-row[_ngcontent-%COMP%]:hover   .remove-button[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .set-size[_ngcontent-%COMP%]{width:40px;height:40px}"]}),e})();var T=o("CBLR"),_=o("f+c0"),N=o("XH8v"),x=o("P4Xx"),R=o("FlRo");function F(e,t){1&e&&(U.Ub(0,"th",13),U.Pc(1,"Name"),U.Tb())}function j(e,t){if(1&e){const e=U.Vb();U.Ub(0,"td",14),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc().clickUser(o)})),U.Pc(1),U.Tb()}if(2&e){const e=t.$implicit;U.Bb(1),U.Sc("",e.FirstName," ",e.LastName,"")}}function B(e,t){1&e&&(U.Ub(0,"th",15),U.Pc(1,"Account Access"),U.Tb())}function A(e,t){if(1&e){const e=U.Vb();U.Ub(0,"td",16),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc().clickUser(o)})),U.Pc(1),U.Tb()}if(2&e){const e=t.$implicit;U.Bb(1),U.Rc(" ",e.Permission," ")}}function E(e,t){1&e&&(U.Ub(0,"th",13),U.Pc(1,"Email"),U.Tb())}function $(e,t){if(1&e){const e=U.Vb();U.Ub(0,"td",14),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc().clickUser(o)})),U.Pc(1),U.Tb()}if(2&e){const e=t.$implicit;U.Bb(1),U.Rc(" ",e.Email," ")}}function V(e,t){1&e&&U.Pb(0,"th",17)}function z(e,t){if(1&e){const e=U.Vb();U.Ub(0,"td",18),U.Ub(1,"mat-icon",19),U.gc("click",(function(){U.Dc(e);const o=t.$implicit;return U.kc().clickDeleteUser(o)})),U.Pc(2," delete "),U.Tb(),U.Tb()}}function H(e,t){1&e&&U.Pb(0,"tr",20)}function J(e,t){1&e&&U.Pb(0,"tr",21)}let q=(()=>{class e{constructor(e){this.apiOrganizationService=e,this.columns=["Name","Access","Email","Actions"],this.users=[],this.userItemClicked=new U.o,this.deleteUserItemClick=new U.o}clickUser(e){this.userItemClicked.emit(e)}clickDeleteUser(e){this.deleteUserItemClick.emit(e)}ngOnChanges(e){if(e.users.currentValue){const t=[];_.a(e.users.currentValue.map(e=>e.OrgID)).forEach(e=>t.push(this.apiOrganizationService.getOrg(e))),Object(x.a)(t).pipe(Object(m.a)(e=>{this.organizationsAsObject=N.a(e,"ID")}))}}}return e.\u0275fac=function(t){return new(t||e)(U.Ob(a.ApiOrganizationService))},e.\u0275cmp=U.Ib({type:e,selectors:[["xenon-user-list"]],inputs:{users:"users"},outputs:{userItemClicked:"userItemClicked",deleteUserItemClick:"deleteUserItemClick"},features:[U.zb],decls:15,vars:3,consts:[["mat-table","",1,"mat-elevation-z0",3,"dataSource"],["matColumnDef","Name"],["mat-header-cell","",4,"matHeaderCellDef"],["class","clickable","mat-cell","",3,"click",4,"matCellDef"],["matColumnDef","Access"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right clickable",3,"click",4,"matCellDef"],["matColumnDef","Email"],["matColumnDef","Actions"],["width","10","mat-header-cell","",4,"matHeaderCellDef"],["class","clickable","width","10","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"clickable",3,"click"],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right","clickable",3,"click"],["width","10","mat-header-cell",""],["width","10","mat-cell","",1,"clickable"],["color","primary",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(U.Ub(0,"table",0),U.Sb(1,1),U.Nc(2,F,2,0,"th",2),U.Nc(3,j,2,2,"td",3),U.Rb(),U.Sb(4,4),U.Nc(5,B,2,0,"th",5),U.Nc(6,A,2,1,"td",6),U.Rb(),U.Sb(7,7),U.Nc(8,E,2,0,"th",2),U.Nc(9,$,2,1,"td",3),U.Rb(),U.Sb(10,8),U.Nc(11,V,1,0,"th",9),U.Nc(12,z,3,0,"td",10),U.Rb(),U.Nc(13,H,1,0,"tr",11),U.Nc(14,J,1,0,"tr",12),U.Tb()),2&e&&(U.sc("dataSource",t.users),U.Bb(13),U.sc("matHeaderRowDef",t.columns),U.Bb(1),U.sc("matRowDefColumns",t.columns))},directives:[R.o,R.c,R.i,R.b,R.k,R.n,R.h,R.a,v.a,R.j,R.m],styles:[".mat-cell[_ngcontent-%COMP%], .mat-footer-cell[_ngcontent-%COMP%], .mat-header-cell[_ngcontent-%COMP%], mat-cell[_ngcontent-%COMP%], mat-footer-cell[_ngcontent-%COMP%], mat-header-cell[_ngcontent-%COMP%]{padding:0 .4rem}[_nghost-%COMP%]   table[_ngcontent-%COMP%]{margin-bottom:80px}"]}),e})();const Q=[{path:"",component:(()=>{class e extends p.a{constructor(e,t,o,r,n,s,a){super(),this.uiPromptService=e,this.notificationService=t,this.apiUserService=o,this.utilLocalStorageService=r,this.apiRoleService=n,this.apiLocationService=s,this.dialog=a,this.search$=new c.a(null),this.users$=[],this.cachedUsers=[],this.columnsToSearchBy=["FirstName","LastName","FullName","Email","Org"],this.unsubscribe=new i.a,this.loggedInUser=this.utilLocalStorageService.getItem("user"),this.searchPipe=new l.a}ngOnInit(){this.refreshData(),this.apiLocationService.getLocationsByOrgId(this.loggedInUser.CurrentOrg.ID).subscribe(e=>{this.orgLocations=e}),this.apiUserService.cachedUsers.pipe(Object(b.a)(this.unsubscribe)).subscribe(e=>{this.users$=e})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.unsubscribe.next(),this.unsubscribe.complete()}deleteUser(e){const t=this.uiPromptService.prompt(`Are you sure you sure you want to delete "${e.FirstName} ${e.LastName}"?`).afterClosed().pipe(Object(u.a)(t=>t.ok?this.apiUserService.deleteUser(this.loggedInUser.CurrentOrg.ID,e.ID):Object(n.a)({Status:"empty"}))).subscribe(e=>{"success"===e.Status&&(this.notificationService.show(g.NotificationType.success,"Close","User Deleted",2500),setTimeout(()=>{this.refreshData()},2500))});this.subscriptions.add(t)}openUserForm(e){this.loggedInUser||(this.loggedInUser=this.utilLocalStorageService.getItem("user"),this.loggedInUser)?this.apiUserService.getUsersByOrganization(this.loggedInUser.CurrentOrg.ID).pipe(Object(b.a)(this.unsubscribe),Object(m.a)(e=>{const t=e.find(e=>e.ID===this.loggedInUser.CurrentUser.ID);return this.loggedInUser.CurrentUser.RoleLocations=t.RoleLocations,t}),Object(u.a)(e=>this.apiRoleService.getRolesByOrg(this.loggedInUser.CurrentOrg.ID)),Object(d.a)(e=>Object(s.a)(e))).subscribe(t=>{const o={user:null!=e?e:void 0,refresh:this.refreshData.bind(this),roles:t.OrgRoleList,locations:this.orgLocations};this.dialog.open(g.UIUserFormComponent,{data:o,panelClass:"full-page-dialog"})}):this.notificationService.show(g.NotificationType.error,"Error","Can not get current user data",2500)}openNewUserForm(){this.dialog.open(M,{data:this.loggedInUser,panelClass:"full-page-dialog"}).afterClosed().pipe(Object(h.a)(1)).subscribe(e=>{this.refreshData()})}searchChange(e){const t=this.searchPipe.transform(this.cachedUsers,e,this.columnsToSearchBy);this.apiUserService.setCachedUsers(t)}refreshData(){this.apiUserService.getUsersByOrganization(this.loggedInUser.CurrentOrg.ID).subscribe(e=>{this.cachedUsers=e,this.apiUserService.setCachedUsers(e)})}}return e.\u0275fac=function(t){return new(t||e)(U.Ob(g.UiPromptService),U.Ob(g.UiNotificationService),U.Ob(a.ApiUserService),U.Ob(l.f),U.Ob(a.ApiRoleService),U.Ob(a.ApiLocationService),U.Ob(O.b))},e.\u0275cmp=U.Ib({type:e,selectors:[["xenon-users"]],features:[U.yb],decls:10,vars:5,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"page-header"],[1,"title"],[3,"searchString","label","searchChange"],[1,"page-body"],[3,"users","userItemClicked","deleteUserItemClick"],["mat-fab","","mat-flat-button","","color","primary","aria-label","Create new Organization",1,"add-button",3,"click"]],template:function(e,t){1&e&&(U.Ub(0,"div",0),U.Ub(1,"h6",1),U.Pc(2,"Users"),U.Tb(),U.Ub(3,"xenon-ui-string-search",2),U.gc("searchChange",(function(e){return t.searchChange(e)})),U.lc(4,"async"),U.Tb(),U.Tb(),U.Ub(5,"div",3),U.Ub(6,"xenon-user-list",4),U.gc("userItemClicked",(function(e){return t.openUserForm(e)}))("deleteUserItemClick",(function(e){return t.deleteUser(e)})),U.Tb(),U.Ub(7,"button",5),U.gc("click",(function(){return t.openNewUserForm()})),U.Ub(8,"mat-icon"),U.Pc(9,"add"),U.Tb(),U.Tb(),U.Tb()),2&e&&(U.Bb(3),U.sc("searchString",U.mc(4,3,t.search$))("label","Search Users"),U.Bb(3),U.sc("users",t.users$))},directives:[C.f,C.e,T.a,q,k.b,v.a],pipes:[L.b],styles:[".add-button[_ngcontent-%COMP%]{position:absolute;bottom:20px;right:20px;border-radius:30px}"]}),e})()}];let X=(()=>{class e{}return e.\u0275mod=U.Mb({type:e}),e.\u0275inj=U.Lb({factory:function(t){return new(t||e)},imports:[[r.f.forChild(Q)],r.f]}),e})();var Y=o("PCNd");let Z=(()=>{class e{}return e.\u0275mod=U.Mb({type:e}),e.\u0275inj=U.Lb({factory:function(t){return new(t||e)},imports:[[Y.a,X,g.UiListSelectModule]]}),e})()}}]);